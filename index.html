<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data-binding</title>
</head>
<body>
    <input type="number" id="inputEl" value=''>
    <span id="value"></span>
    <button id="increment">Increment</button>
    <button id="decrement">Decrement</button>


    <script>
        function State(value) {
            return {
                value,
                hook: null,
                get getState() {
                    console.log('getter is called')
                    return this.value
                },
                set setState(param) {
                    console.log('setter is called')
                    this.value = param instanceof Function ? param(this.value) : param
                    if(this.hook instanceof Function) this.hook()
                },
                set setHook(param) {
                    if(param instanceof Function) return this.hook = param
                }
            }
        }

        window.addEventListener('load', () => {
            const valueEl1 = document.getElementById('value')
            const inputEl1 = document.getElementById('inputEl')
            const incrementEl = document.getElementById('increment')
            const decrementEl = document.getElementById('decrement')


            const updateElement = (value) => {
                valueEl1.innerText = value
                inputEl1.value = value
            }

            const state = new State(0)

            state.setHook = () => {
                updateElement(state.getState)
            }
            updateElement(state.getState)

            inputEl1.addEventListener('change', e => {
                state.setState = (prev) => {
                    if(!e.target.value) return prev
                    if(prev < 0) return prev
                    return Number(prev) - 1
                }
            })

            incrementEl.addEventListener('click', e => {
                state.setState = (prev) => Number(prev) + 1
            })

            decrementEl.addEventListener('click', () => {
                state.setState = (prev) => {
                    if(prev > 0) return Number(prev) - 1
                    return prev
                }
            })

            setInterval(() => {
                state.setState = prev => prev + 1
            }, 1000);
        })
    </script>
</body>
</html>